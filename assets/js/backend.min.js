var Backend= function () {
    /// <summary>Constructor function of the event backend class.</summary>
    /// <returns type="Home" />
  
    return {


        ///<summary>
        ///Initializes the admin.  
        ///</summary>     
        ///<returns type="initialization settings" />   
        /// <since>1.0.0</since> 
        init: function() 
        {			
				
			
			
		    	//Bind on click event of the settings section
			jQuery(".nav-tab-wrapper a").on('click',Backend.settings.tabClick);
		  	
		  	 //show by default first Event Listings Settings Tab
			jQuery('.nav-tab-wrapper a:first').click();

			jQuery("#gam_db_backup_start_backup").on('click', Backend.settings.startBackup);
			
			jQuery("#gam_db_backup_schedules_options_save").on('click', Backend.settings.saveSchedulesOptions);
			
			var defaultValue=jQuery("input[name='gam_db_backup_schedules_options']:checked").val();
			
			if(defaultValue=='' || defaultValue == undefined || defaultValue==null)
			      jQuery("#gam_db_backup_schedules_options_none").attr("checked","checked");
			
			
	 },
	 settings :
	 {
	    	   	   /// <summary>
			   /// Click on tab            
			   /// </summary>
			   /// <param name="parent" type="Event"></param>           
			   /// <returns type="actions" />     
			   /// <since>1.0.0</since>       
			   tabClick: function(event) 
			   {
				   
			   	    event.preventDefault();
     			       
			   	    jQuery('.settings_panel').hide();
				    jQuery('.nav-tab-active').removeClass('nav-tab-active');
				    jQuery( jQuery(this).attr('href') ).show();
				    jQuery(this).addClass('nav-tab-active');
				    
				    //hide download file link and lable intially
				    jQuery("#gam_db_backup_download_file").hide();
			            jQuery('label[for="setting-gam_db_backup_download_file"]').hide();
			            
			            //remove success message if already exist
				    jQuery('#success-message').remove();				
				
				    var option= jQuery( "#setting-event_manager_submission_expire_options:last option:selected" ).val();	
				    if ( option =='days' ) 
				       jQuery('#setting-event_manager_submission_duration').closest('tr').show();
				    else
				       jQuery('#setting-event_manager_submission_duration').closest('tr').hide();
				   
				    return false;
			   },
			   
		            /// <summary>
		            /// Click on tab download            
		            /// </summarysummary>
		            /// <param name="parent" type="Event"></param>           
		            /// <returns type="actions" />     
		            /// <since>1.0.0</since>       
			    startBackup: function (event)
			    {
							
				    event.preventDefault();

			               jQuery.ajax({
							   
			                   type: 'GET',
			                   dataType: 'json',			                   
			                   url: gam_db_backup_admin_js.ajax_url,
			                   data:
		                           {
		                                  'action': 'db_backup_now' //calls wp_ajax_db_backup_now, we can define any name of action here. wp_ajax_{cutom action name}                                 
		
		                           },
			                   beforeSend: function (jqXHR, settings) {
			                       jQuery('#gam_db_backup_start_backup').after('<span id="loading-message"> ' + gam_db_backup_admin_js.loading_message + '</span>');
			                   },
			                   success: function (data)
			                   {	
					        
						jQuery("#gam_db_backup_download_file").show();
						jQuery('label[for="setting-gam_db_backup_download_file"]').show();											
						jQuery("#gam_db_backup_download_file").attr("href",data.FullDownloadPath);						
			                       
			                   },
			                   error: function (jqXHR, textStatus, errorThrown) 
			                   {	

			                   },
			                   complete: function (jqXHR, textStatus) {
								     
						 jQuery('#loading-message').remove();
			                   }

			               });
			    },
			    
			    
			    /// <summary>
		            /// Save selected schedule option        
		            /// </summarysummary>
		            /// <param name="parent" type="Event"></param>           
		            /// <returns type="actions" />     
		            /// <since>1.0.0</since>       
			    saveSchedulesOptions: function (event)
			    {
							
				      event.preventDefault();		     
				    

			               jQuery.ajax({
							   
			                   type: 'POST',
			                   dataType: 'json',			                   
			                   url: gam_db_backup_admin_js.ajax_url,
			                   data:
		                           {
		                                  'action': 'save_selected_schedule_option',
		                                  'selected_schedule_option': jQuery("input[name='gam_db_backup_schedules_options']:checked").val()                        
		
		                           },
			                   beforeSend: function (jqXHR, settings) 
			                   {			                       
			                       jQuery('#gam_db_backup_schedules_options_save').after('<span id="loading-message"> ' + gam_db_backup_admin_js.loading_message + '</span>');
			                   },
			                   success: function (data)
			                   {
						jQuery('#gam_db_backup_schedules_options_save').after('<br/><br/><span id="success-message">'+data.Message + '</span>');			
			                       
			                   },
			                   error: function (jqXHR, textStatus, errorThrown) 
			                   {			                     

			                   },
			                   complete: function (jqXHR, textStatus) {
								     
						 jQuery('#loading-message').remove();
			                   }

			               });
			    }

	}       

       
			 
    } //enf of return
	
}; //end of class
Backend= Backend();

jQuery(document).ready(function($) 
{
   Backend.init();
});